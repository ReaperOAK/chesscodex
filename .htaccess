<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # Remove trailing slash from URLs
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)/$ /$1 [L,R=301]

    # Redirect all requests to index.html
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^ index.html [L]

    # Set CORS headers
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type, Authorization"
    Header set Cross-Origin-Opener-Policy "same-origin"
    Header set Cross-Origin-Embedder-Policy "cross-origin"
    Header set Cross-Origin-Resource-Policy "cross-origin"

    # Content Security Policy for external scripts, fonts, images, and iframes (Google Maps, Google Tag Manager, Google Ads)
            Header set Content-Security-Policy "default-src 'self'; \
                script-src 'self' 'unsafe-inline' https://unpkg.com https://www.googletagmanager.com https://pagead2.googlesyndication.com; \
                script-src-elem 'self' 'unsafe-inline' https://unpkg.com https://www.googletagmanager.com https://pagead2.googlesyndication.com; \
                style-src 'self' 'unsafe-inline' https://unpkg.com https://fonts.googleapis.com; \
                style-src-elem 'self' 'unsafe-inline' https://unpkg.com https://fonts.googleapis.com; \
                font-src 'self' https://fonts.gstatic.com data:; \
                img-src 'self' data: https://kolkatachessacademy.in https://www.google.com https://maps.gstatic.com https://maps.googleapis.com https://pagead2.googlesyndication.com https://tpc.googlesyndication.com https://lh3.googleusercontent.com https://yt3.ggpht.com https://cdn.jsdelivr.net https://res.cloudinary.com; \
                frame-src 'self' https://www.google.com https://www.youtube.com https://maps.google.com; \
                connect-src 'self' https://unpkg.com https://www.googletagmanager.com https://pagead2.googlesyndication.com;\
                object-src 'none';"
# Set X-Frame-Options header via HTTP (not meta tag)
Header always set X-Frame-Options "SAMEORIGIN"
</IfModule>

# Handle 404 errors
ErrorDocument 404 /index.html